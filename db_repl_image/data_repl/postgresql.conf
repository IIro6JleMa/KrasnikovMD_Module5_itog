# -----------------------------
# PostgreSQL configuration file
# -----------------------------
#
# This file consists of lines of the form:
#
#   name = value
#
# (The "=" is optional.)  Whitespace may be used.  Comments are introduced with
# "#" anywhere on a line.  The complete list of parameter names and allowed
# values can be found in the PostgreSQL documentation.
#
# The commented-out settings shown in this file represent the default values.
# Re-commenting a setting is NOT sufficient to revert it to the default value;
# you need to reload the server.
#
# This file is read on server startup and when the server receives a SIGHUP
# signal.  If you edit the file on a running system, you have to SIGHUP the
# server for the changes to take effect, run "pg_ctl reload", or execute
# "SELECT pg_reload_conf()".  Some parameters, which are marked below,
# require a server shutdown and restart to take effect.
#
# Any parameter can also be given as a command-line option to the server, e.g.,
# "postgres -c log_connections=on".  Some parameters can be changed at run time
# with the "SET" SQL command.
#
# Memory units:  B  = bytes            Time units:  us  = microseconds
#                kB = kilobytes                     ms  = milliseconds
#                MB = megabytes                     s   = seconds
#                GB = gigabytes                     min = minutes
#                TB = terabytes                     h   = hours
#                                                   d   = days

#------------------------------------------------------------------------------
# FILE LOCATIONS
#------------------------------------------------------------------------------

# The default values of these variables are driven from the -D command-line
# option or PGDATA environment variable, represented here as ConfigDir.

#data_directory = 'ConfigDir'    # use data in another directory
          # (change requires restart)
#hba_file = 'ConfigDir/pg_hba.conf'  # host-based authentication file
          # (change requires restart)
#ident_file = 'ConfigDir/pg_ident.conf'  # ident configuration file
          # (change requires restart)

# If external_pid_file is not explicitly set, no extra PID file is written.
#external_pid_file = ''      # write an extra PID file
          # (change requires restart)


#------------------------------------------------------------------------------
# CONNECTIONS AND AUTHENTICATION
#------------------------------------------------------------------------------

# - Connection Settings -
# $$$
listen_addresses = 'localhost'
          # comma-separated list of addresses;
          # defaults to 'localhost'; use '*' for all
# $$$          # (change requires restart)
port = 5432        # (change requires restart)
max_connections = 100      # (change requires restart)
#superuser_reserved_connections = 3  # (change requires restart)
# $$$
unix_socket_directories = '/var/run/postgresql'  # comma-separated list of directories
          # (change requires restart)
#unix_socket_group = ''      # (change requires restart)
#unix_socket_permissions = 0777    # begin with 0 to use octal notation
          # (change requires restart)
#bonjour = off        # advertise server via Bonjour
          # (change requires restart)
#bonjour_name = ''      # defaults to the computer name
          # (change requires restart)

# - TCP settings -
# see "man tcp" for details

#tcp_keepalives_idle = 0    # TCP_KEEPIDLE, in seconds;
          # 0 selects the system default
#tcp_keepalives_interval = 0    # TCP_KEEPINTVL, in seconds;
          # 0 selects the system default
#tcp_keepalives_count = 0    # TCP_KEEPCNT;
          # 0 selects the system default
#tcp_user_timeout = 0      # TCP_USER_TIMEOUT, in milliseconds;
          # 0 selects the system default

#client_connection_check_interval = 0  # time between checks for client
          # disconnection while running queries;
          # 0 for never

# - Authentication -
#authentication_timeout = 1min    # 1s-600s
#password_encryption = scram-sha-256  # scram-sha-256 or md5
#db_user_namespace = off

# GSSAPI using Kerberos
#krb_server_keyfile = 'FILE:${sysconfdir}/krb5.keytab'
#krb_caseins_users = off

# - SSL -
#ssl = off
#ssl_ca_file = ''
#ssl_cert_file = 'server.crt'
#ssl_crl_file = ''
#ssl_crl_dir = ''
#ssl_key_file = 'server.key'
#ssl_ciphers = 'HIGH:MEDIUM:+3DES:!aNULL' # allowed SSL ciphers
#ssl_prefer_server_ciphers = on
#ssl_ecdh_curve = 'prime256v1'
#ssl_min_protocol_version = 'TLSv1.2'
#ssl_max_protocol_version = ''
#ssl_dh_params_file = ''
#ssl_passphrase_command = ''
#ssl_passphrase_command_supports_reload = off


#------------------------------------------------------------------------------
# RESOURCE USAGE (except WAL)
#------------------------------------------------------------------------------

# - Memory -
shared_buffers = 128MB      # min 128kB
          # (change requires restart)
#huge_pages = try      # on, off, or try
          # (change requires restart)
#huge_page_size = 0      # zero for system default
          # (change requires restart)
#temp_buffers = 8MB      # min 800kB
#max_prepared_transactions = 0    # zero disables the feature
          # (change requires restart)
# Caution: it is not advisable to set max_prepared_transactions nonzero unless
# you actively intend to use prepared transactions.
#work_mem = 4MB        # min 64kB
#hash_mem_multiplier = 2.0    # 1-1000.0 multiplier on hash table work_mem
#maintenance_work_mem = 64MB    # min 1MB
#autovacuum_work_mem = -1    # min 1MB, or -1 to use maintenance_work_mem
#logical_decoding_work_mem = 64MB  # min 64kB
#max_stack_depth = 2MB      # min 100kB
#shared_memory_type = mmap    # the default is the first option
          # supported by the operating system:
          #   mmap
          #   sysv
          #   windows
dynamic_shared_memory_type = posix  # the default is usually the first option
#min_dynamic_shared_memory = 0MB  # (change requires restart)

# - Disk -
#temp_file_limit = -1      # limits per-process temp file space
          # in kilobytes, or -1 for no limit

# - Kernel Resources -
#max_files_per_process = 1000    # min 64
          # (change requires restart)

# - Cost-Based Vacuum Delay -
#vacuum_cost_delay = 0      # 0-100 milliseconds (0 disables)
#vacuum_cost_page_hit = 1    # 0-10000 credits
#vacuum_cost_page_miss = 2    # 0-10000 credits
#vacuum_cost_page_dirty = 20    # 0-10000 credits
#vacuum_cost_limit = 200    # 1-10000 credits

# - Background Writer -
#bgwriter_delay = 200ms      # 10-10000ms between rounds
#bgwriter_lru_maxpages = 100    # max buffers written/round, 0 disables
#bgwriter_lru_multiplier = 2.0    # 0-10.0 multiplier on buffers scanned/round
#bgwriter_flush_after = 512kB    # measured in pages, 0 disables

# - Asynchronous Behavior -
#backend_flush_after = 0    # measured in pages, 0 disables
#effective_io_concurrency = 1    # 1-1000; 0 disables prefetching
#maintenance_io_concurrency = 10  # 1-1000; 0 disables prefetching
#max_worker_processes = 8    # (change requires restart)
#max_parallel_workers_per_gather = 2  # limited by max_parallel_workers
#max_parallel_maintenance_workers = 2  # limited by max_parallel_workers
#max_parallel_workers = 8    # number of max_worker_processes that
          # can be used in parallel operations
#parallel_leader_participation = on
#old_snapshot_threshold = -1    # 1min-60d; -1 disables; 0 is immediate
          # (change requires restart)


#------------------------------------------------------------------------------
# WRITE-AHEAD LOG
#------------------------------------------------------------------------------

# - Settings -
# $$$
wal_level = replica      # minimal, replica, or logical
          # (change requires restart)
#fsync = on        # flush data to disk for crash safety
          # (turning this off can cause
          # unrecoverable data corruption)
#synchronous_commit = on    # synchronization level;
#wal_sync_method = fsync    # the default is the first option
#full_page_writes = on      # recover from partial page writes
# $$$
wal_log_hints = on      # also do full page writes of non-critical updates
          # (change requires restart)
#wal_compression = off      # enables compression of full-page writes;
#wal_init_zero = on      # zero-fill new WAL files
#wal_recycle = on      # recycle WAL files
#wal_buffers = -1      # min 32kB, -1 sets based on shared_buffers
#wal_writer_delay = 200ms    # 1-10000 milliseconds
#commit_delay = 0      # range 0-100000, in microseconds
#commit_siblings = 5      # range 1-1000

# - Checkpoints -
#checkpoint_timeout = 5min    # range 30s-1d
#checkpoint_completion_target = 0.9  # checkpoint target duration, 0.0 - 1.0
#checkpoint_flush_after = 256kB    # measured in pages, 0 disables
#checkpoint_warning = 30s    # 0 disables
max_wal_size = 1GB
min_wal_size = 80MB


#------------------------------------------------------------------------------
# REPLICATION
#------------------------------------------------------------------------------

# Settings for replication
hot_standby = on                     # Enable read queries on replica
max_wal_senders = 10                 # Number of replication slots
wal_keep_size = 128MB                # Amount of WAL to keep for standby
primary_conninfo = 'host=db port=5432 user=postgres password=12345678'  # Connection string to primary
primary_slot_name = 'replica_slot'   # Replication slot name
promote_trigger_file = '/tmp/promote_to_primary'  # File whose presence ends recovery


#------------------------------------------------------------------------------
# ARCHIVING AND RECOVERY
#------------------------------------------------------------------------------
archive_mode = on            # Enables archiving
archive_command = 'cp %p /oracle/pg_data/archive/%f'  # Command to archive logs
restore_command = 'cp /path_to_archive/%f %p'  # Command to restore WAL during recovery

#------------------------------------------------------------------------------
# LOGGING
#------------------------------------------------------------------------------
logging_collector = on              # Enable logging to files
log_directory = '/var/log/postgresql/'  # Directory where logs are stored
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'  # Log file naming pattern
log_connections = on                # Log when connections are made
log_disconnections = on             # Log when connections are closed
log_line_prefix = '%m [%p] %u@%d '  # Log entry prefix
log_statement = 'none'              # Log only statements that modify data
log_timezone = 'Etc/UTC'

datestyle = 'iso, mdy'
timezone = 'Etc/UTC'
lc_messages = 'en_US.utf8'      # locale for system error message
lc_monetary = 'en_US.utf8'      # locale for monetary formatting
lc_numeric = 'en_US.utf8'       # locale for number formatting
lc_time = 'en_US.utf8'          # locale for time formatting

#------------------------------------------------------------------------------
# CUSTOMIZED OPTIONS
#------------------------------------------------------------------------------
# Add settings for extensions here
